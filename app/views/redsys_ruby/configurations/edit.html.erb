<style>
  .redsys-config-container {
    max-width: 600px;
    margin: 40px auto;
    padding: 30px;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(10px);
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
  }

  .redsys-header {
    text-align: center;
    margin-bottom: 30px;
  }

  .redsys-header h1 {
    color: #1a1a1a;
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 8px;
  }

  .redsys-header p {
    color: #666;
    font-size: 14px;
  }

  .redsys-form-group {
    margin-bottom: 20px;
  }

  .redsys-label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: #444;
    margin-bottom: 8px;
  }

  .redsys-input, .redsys-select {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 15px;
    transition: all 0.3s ease;
    box-sizing: border-box;
  }

  .redsys-input:focus, .redsys-select:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
  }

  .redsys-submit {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    margin-top: 10px;
  }

  .redsys-submit:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
  }

  .redsys-notice {
    padding: 12px 16px;
    background: #ecfdf5;
    color: #065f46;
    border-radius: 8px;
    margin-bottom: 20px;
    font-size: 14px;
  }

  .redsys-errors {
    padding: 12px 16px;
    background: #fef2f2;
    color: #991b1b;
    border-radius: 8px;
    margin-bottom: 20px;
    font-size: 14px;
  }
</style>

<div class="redsys-config-container">
  <div class="redsys-header">
    <h1>Configurar Redsys</h1>
    <p>Introduce tus credenciales del TPVVirtual</p>
  </div>

  <% if flash[:notice] %>
    <div class="redsys-notice">
      <%= flash[:notice] %>
    </div>
  <% end %>

  <% if @configuration.errors.any? %>
    <div class="redsys-errors">
      <ul>
        <% @configuration.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form_with model: @configuration, url: configuration_path, method: :patch, local: true do |f| %>
    <div class="redsys-form-group">
      <%= f.label :merchant_key, "Merchant Key (FUC Key)", class: "redsys-label" %>
      <% if @configuration.merchant_key_from_secure_source? %>
        <div class="redsys-input" style="background: #ecfdf5; color: #065f46; border-color: #10b981; display: flex; align-items: center; gap: 8px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
          Configurada mediante variable de entorno o credenciales
        </div>
      <% else %>
        <%= f.password_field :merchant_key, class: "redsys-input", placeholder: "Ej: sq7H5YzEBhyUTLe6BArsth4i..." %>
        <p style="font-size: 12px; color: #b91c1c; margin-top: 8px; display: flex; align-items: flex-start; gap: 6px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; margin-top: 2px;"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
          <span>Por seguridad, se recomienda configurar esta clave mediante la variable de entorno <code>REDSYS_MERCHANT_KEY</code> o en las credenciales encriptadas de Rails.</span>
        </p>
      <% end %>
    </div>

    <div class="redsys-form-group">
      <%= f.label :merchant_code, "Código de Comercio (FUC)", class: "redsys-label" %>
      <%= f.text_field :merchant_code, class: "redsys-input", placeholder: "Ej: 999008881" %>
    </div>

    <div class="redsys-form-group">
      <%= f.label :terminal, "Terminal", class: "redsys-label" %>
      <%= f.text_field :terminal, class: "redsys-input", placeholder: "Ej: 001" %>
    </div>

    <div class="redsys-form-group">
      <%= f.label :environment, "Entorno", class: "redsys-label" %>
      <%= f.select :environment, [["Pruebas", "test"], ["Producción", "production"]], {}, class: "redsys-select" %>
    </div>

    <%= f.submit "Guardar Configuración", class: "redsys-submit" %>
  <% end %>
</div>
